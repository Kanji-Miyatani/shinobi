{"ast":null,"code":"import _toConsumableArray from\"C:/Users/k-miyatani/Pub/NEETsInCompanyWeb/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/k-miyatani/Pub/NEETsInCompanyWeb/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import io from'socket.io-client';import{useState,useEffect,useRef}from'react';import{useSelector}from'react-redux';import DressInput from'@mui/material/TextField';import AvatarIcon from'../components/AvatorIcon';import Button from'@mui/material/Button';import List from'@mui/material/List';import ListItem from'@mui/material/ListItem';import ListItemButton from'@mui/material/ListItemButton';import ListItemText from'@mui/material/ListItemText';import ListItemAvatar from'@mui/material/ListItemAvatar';import Checkbox from'@mui/material/Checkbox';import Avatar from'@mui/material/Avatar';import store from'../store/store.js';import AvatorIcon from'./AvatorIcon';import'../style/ChatRoom.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ChatRoom(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messageList=_useState2[0],setMessageList=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),users=_useState6[0],setUsers=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),flagShowChat=_useState8[0],setFlagShowChat=_useState8[1];var socketref=useRef();function thisfocus(){document.getElementById('message').focus();setFlagShowChat(true);};function thisblur(){setFlagShowChat(false);};//送信イベント\nfunction submitEvent(e){e.preventDefault();if(socketref!==undefined){//ソケットを通してset_nameイベントを発火する\nvar avator=store.getState().loginInfoReducer.avatorType;var name=store.getState().loginInfoReducer.name;socketref.current.emit('message',{avatorType:avator,name:name,message:message});document.getElementById('message').value='';setMessage('');}};useEffect(function(){socketref.current=io();socketref.current.emit('entry',{name:store.getState().loginInfoReducer.name,avatorType:store.getState().loginInfoReducer.avatorType});//ユーザー取得\nsocketref.current.on('users list',function(users){console.log(users);setUsers(users);});//メッセージ取得\nsocketref.current.on('receive',function(msg){console.log('receive');var message=msg.message,name=msg.name,avatorType=msg.avatorType;setMessageList(function(list){return[].concat(_toConsumableArray(list),[{name:name,message:message,avatorType:avatorType}]);});});return function(){socketref.current.disconnect();};},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"ChatRoom\",onBlur:function onBlur(){thisblur();},onFocus:function onFocus(){thisfocus();},onClick:function onClick(){if(!flagShowChat){thisfocus();}},style:flagShowChat?{opacity:'1.0'}:{opacity:'0.18'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"avators-row\",children:users?users.map(function(user){console.log(user);return/*#__PURE__*/_jsx(\"div\",{children:user.name});}):null}),/*#__PURE__*/_jsx(\"header\",{className:\"ChatRoom-header\",id:\"Chat-DispArea\",children:/*#__PURE__*/_jsx(List,{dense:true,sx:{width:'100%',bgcolor:'rgba(255, 255, 255, 0.15)'},children:messageList.slice(messageList.length-13<0?0:messageList.length-13).map(function(value,id){var labelId=\"checkbox-list-secondary-label-\".concat(value);return/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(AvatarIcon,{avatorType:value.avatorType,height:\"36px\"})}),/*#__PURE__*/_jsx(ListItemText,{id:labelId,primary:\"\".concat(value.name,\" > \").concat(value.message)})]},id);})})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:function onSubmit(e){submitEvent(e);},autoComplete:\"off\",children:[/*#__PURE__*/_jsx(DressInput,{label:\"\",variant:\"standard\",className:\"input--\",autoComplete:\"off\",id:\"message\",type:\"text\",onChange:function onChange(e){return setMessage(e.target.value);}}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",type:\"submit\",children:\"\\u9001\\u4FE1\"})]})]});}export default ChatRoom;","map":{"version":3,"sources":["C:/Users/k-miyatani/Pub/NEETsInCompanyWeb/frontend/src/components/ChatRoom.js"],"names":["io","useState","useEffect","useRef","useSelector","DressInput","AvatarIcon","Button","List","ListItem","ListItemButton","ListItemText","ListItemAvatar","Checkbox","Avatar","store","AvatorIcon","ChatRoom","messageList","setMessageList","message","setMessage","users","setUsers","flagShowChat","setFlagShowChat","socketref","thisfocus","document","getElementById","focus","thisblur","submitEvent","e","preventDefault","undefined","avator","getState","loginInfoReducer","avatorType","name","current","emit","value","on","console","log","msg","list","disconnect","opacity","map","user","width","bgcolor","slice","length","id","labelId","target"],"mappings":"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","sourcesContent":["import io from 'socket.io-client';\r\nimport { useState ,useEffect,useRef} from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport DressInput from '@mui/material/TextField';\r\nimport AvatarIcon from '../components/AvatorIcon';\r\nimport Button from '@mui/material/Button';\r\nimport List from '@mui/material/List';\r\nimport ListItem from '@mui/material/ListItem';\r\nimport ListItemButton from '@mui/material/ListItemButton';\r\nimport ListItemText from '@mui/material/ListItemText';\r\nimport ListItemAvatar from '@mui/material/ListItemAvatar';\r\nimport Checkbox from '@mui/material/Checkbox';\r\nimport Avatar from '@mui/material/Avatar';\r\nimport store from '../store/store.js';\r\nimport AvatorIcon from './AvatorIcon';\r\nimport '../style/ChatRoom.css'\r\nfunction ChatRoom() {\r\n    const [messageList,setMessageList] = useState([]);\r\n    const [message, setMessage] = useState('');\r\n    const [users, setUsers] = useState([]);\r\n    const [flagShowChat, setFlagShowChat] = useState(false);\r\n    const socketref = useRef();\r\n    function thisfocus(){\r\n        document.getElementById('message').focus();\r\n        setFlagShowChat(true);\r\n    };\r\n    function thisblur(){\r\n        setFlagShowChat(false);\r\n    };\r\n    //送信イベント\r\n    function submitEvent(e){\r\n        e.preventDefault();\r\n      if (socketref !== undefined){\r\n        //ソケットを通してset_nameイベントを発火する\r\n        const avator = store.getState().loginInfoReducer.avatorType;\r\n        const name = store.getState().loginInfoReducer.name;\r\n        socketref.current.emit('message',{avatorType:avator,name:name,message:message});\r\n        document.getElementById('message').value='';\r\n        setMessage('');\r\n      }\r\n    };\r\n    useEffect(()=>{\r\n        socketref.current=io();\r\n        socketref.current.emit('entry', {\r\n          name:store.getState().loginInfoReducer.name,\r\n          avatorType:store.getState().loginInfoReducer.avatorType,\r\n        });\r\n        //ユーザー取得\r\n        socketref.current.on('users list',(users)=>{\r\n           console.log(users);\r\n            setUsers(users);\r\n        })\r\n        //メッセージ取得\r\n        socketref.current.on('receive',(msg)=>{\r\n            console.log('receive');\r\n            const {message,name,avatorType} = msg;\r\n                setMessageList(list=>[...list, {\r\n                    name:name,\r\n                    message:message,\r\n                    avatorType:avatorType\r\n                }]);\r\n        });\r\n        return ()=>{socketref.current.disconnect()};\r\n    },[]);\r\n \r\n  return (\r\n    <div className=\"ChatRoom\" \r\n    onBlur={()=>{thisblur()}}\r\n    onFocus={()=>{thisfocus()}} \r\n    onClick={()=>{if(!flagShowChat){\r\n      thisfocus()\r\n    }}} style={flagShowChat?{opacity:'1.0'}:{opacity:'0.18'}}>\r\n       <div className=\"avators-row\">\r\n        {\r\n            users?users.map((user)=>{\r\n              console.log(user);\r\n              return(\r\n              <div>\r\n                {user.name}\r\n              </div>)\r\n            }):null\r\n          }\r\n      </div>\r\n      <header className=\"ChatRoom-header\" id=\"Chat-DispArea\">\r\n       <List dense sx={{ width: '100%', bgcolor:'rgba(255, 255, 255, 0.15)' }}>\r\n      {messageList.slice(messageList.length-13<0?0:messageList.length-13).map((value,id) => {\r\n        const labelId = `checkbox-list-secondary-label-${value}`;\r\n        return (\r\n          <ListItem\r\n            key={id}>\r\n            <ListItemAvatar>\r\n             <AvatarIcon avatorType={value.avatorType} height=\"36px\" />\r\n            </ListItemAvatar>\r\n            <ListItemText id={labelId} primary={`${value.name} > ${value.message}`}  />\r\n          </ListItem>\r\n        );\r\n      })}\r\n    </List>\r\n    </header>\r\n    <form onSubmit={(e)=>{submitEvent(e);}} autoComplete=\"off\">\r\n        <DressInput label=\"\" variant=\"standard\" className=\"input--\" autoComplete=\"off\" id=\"message\" type=\"text\" onChange={e => setMessage(e.target.value)} />\r\n        <Button variant=\"outlined\" type=\"submit\">送信\r\n        </Button>\r\n    </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatRoom;\r\n"]},"metadata":{},"sourceType":"module"}